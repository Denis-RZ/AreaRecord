@model IEnumerable<MyWebApp.Models.PageSection>
@{
    ViewData["Title"] = "Page Sections";
    Layout = "../Admin/_AdminLayout";
}
<h2>Page Sections</h2>
<form method="get" asp-action="Index">
    <input type="text" name="q" value="@ViewBag.Query" placeholder="Search" />
    <button type="submit">Search</button>
</form>
<p><a asp-action="Create">Create New</a></p>
<table>
    <thead>

        <tr><th>Page</th><th>Zone</th><th>Type</th><th colspan="2"></th></tr>

    </thead>
    <tbody id="sortable" asp-page-handler="Reorder">
@foreach (var s in Model)
{
    <tr data-id="@s.Id">
        <td>@s.Page?.Slug</td>
        <td>@s.Zone</td>

        <td>@s.Type</td>

        <td><a asp-action="Edit" asp-route-id="@s.Id">Edit</a></td>
        <td><a asp-action="Delete" asp-route-id="@s.Id">Delete</a></td>
    </tr>
}
    </tbody>
</table>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script>
        $('#sortable').sortable({
          helper: 'clone',
          stop: function () {
            const ids = $('#sortable tr').map((_, el) => $(el).data('id')).get();
            $.post('/AdminPageSection/Reorder', { ids });
          }
        });
    </script>
}
