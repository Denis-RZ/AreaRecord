@model MyWebApp.Models.Page
@{
    ViewData["Title"] = "Edit Page";
    Layout = "../Admin/_AdminLayout";
    var templates = ViewBag.Templates as List<MyWebApp.Models.BlockTemplate>;
}
<h2>Edit Page</h2>
<form asp-action="Edit" method="post">
    <input type="hidden" asp-for="Id" />
    <div><label>Slug</label><input asp-for="Slug" /></div>
    <div><label>Title</label><input asp-for="Title" /></div>
    <div><label asp-for="MetaDescription"></label><input asp-for="MetaDescription" /></div>
    <div><label asp-for="MetaKeywords"></label><input asp-for="MetaKeywords" /></div>
    <div><label asp-for="OgTitle"></label><input asp-for="OgTitle" /></div>
    <div><label asp-for="OgDescription"></label><input asp-for="OgDescription" /></div>
    <div><label asp-for="Category"></label><input asp-for="Category" /></div>
    <div><label asp-for="Tags"></label><input asp-for="Tags" /></div>
    <div><label asp-for="FeaturedImage"></label><input asp-for="FeaturedImage" /></div>
    <div><label asp-for="IsPublished"></label><input asp-for="IsPublished" /></div>
    <div><label asp-for="PublishDate"></label><input asp-for="PublishDate" type="datetime-local" /></div>
    <div>
        <label>Header</label>
        <div id="header-editor" class="quill-editor"></div>
        <input type="hidden" asp-for="HeaderHtml" />
    </div>
    <div>
        <label>Body</label>
        <div id="body-editor" class="quill-editor"></div>
        <input type="hidden" asp-for="BodyHtml" />
    </div>
    <div>
        <label>Insert Block</label>
        <select id="template-select">
            <option value="">--select--</option>
            @foreach (var t in templates)
            {
                <option value="@t.Id">@t.Name</option>
            }
        </select>
        <button type="button" id="insert-template">Insert</button>
    </div>
    <div>
        <label>Footer</label>
        <div id="footer-editor" class="quill-editor"></div>
        <input type="hidden" asp-for="FooterHtml" />
    </div>
    <button type="submit">Save</button>
</form>
<script>
    const headerQuill = new Quill('#header-editor', { theme: 'snow' });
    const bodyQuill = new Quill('#body-editor', { theme: 'snow' });
    const footerQuill = new Quill('#footer-editor', { theme: 'snow' });
    headerQuill.root.innerHTML = document.getElementById('HeaderHtml').value;
    bodyQuill.root.innerHTML = document.getElementById('BodyHtml').value;
    footerQuill.root.innerHTML = document.getElementById('FooterHtml').value;
    document.querySelector('form').addEventListener('submit', function () {
        document.getElementById('HeaderHtml').value = headerQuill.root.innerHTML;
        document.getElementById('BodyHtml').value = bodyQuill.root.innerHTML;
        document.getElementById('FooterHtml').value = footerQuill.root.innerHTML;
    });
    const templates = JSON.parse(document.getElementById('templates-data').textContent);
    document.getElementById('insert-template').addEventListener('click', function () {
        const sel = document.getElementById('template-select');
        const id = parseInt(sel.value);
        const tpl = templates.find(t => t.id === id);
        if (tpl) {
            bodyQuill.clipboard.dangerouslyPasteHTML(bodyQuill.getLength(), tpl.html);
        }
    });
</script>
<script id="templates-data" type="application/json">
@Html.Raw(System.Text.Json.JsonSerializer.Serialize(templates))
</script>
